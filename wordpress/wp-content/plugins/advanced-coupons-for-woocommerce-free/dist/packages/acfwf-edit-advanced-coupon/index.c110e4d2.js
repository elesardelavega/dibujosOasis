function si(){import.meta.url,import("_").catch(()=>1);async function*e(){}}function Ye(){const{cart_condition_fields:e,cart_condition_field_groups:t,product_table_buttons:o,add_new_and_rule:n}=acfw_edit_coupon,i=Object.keys(e).map(c=>e[c]);return'\n    <div class="condition-group-actions">\n      <div class="add-condition-form" style="display: none;">\n        <select class="condition-types" data-placeholder="Search/select condition fields">\n          <option value="">Search</option>\n          '.concat(t.map(c=>Ze(c,i)).join(""),'\n        </select>\n        <button type="button" class="add-condition-field button-primary">').concat(o.add,'</button>\n        <button type="button" class="cancel-add-condition-field button">').concat(o.cancel,'</button>\n      </div>\n      <button type="button" class="add-condition-trigger button">\n        <i class="dashicons dashicons-plus"></i>\n        ').concat(n,"\n      </button>\n    </div>\n  ")}function Ze(e,t){const{group:o,label:n}=e,i=t.filter(c=>c.group===o||o==="others"&&c.group===void 0);if(i.length)return'\n    <optgroup label="'.concat(n,'">\n      ').concat(i.map(c=>'<option value="'.concat(c.key,'">').concat(c.title,"</option>")).join(""),"\n    </optgroup>\n  ")}function Ke(){jQuery("select.condition-types").select2()}const T=jQuery,te=document.querySelector("#acfw_cart_conditions");function be(){const e=T(this),t=e.closest("div.condition-group-actions");e.hasClass("add-condition-trigger")?(t.find(".add-condition-form").show(),Ke(),e.hide()):(t.find(".add-condition-form").hide(),t.find(".add-condition-trigger").show())}function O(e){T(te).data("editing",e),T(te).find("#save-cart-conditions").prop("disabled",!e)}function Xe(){const e=T(this),t=e.closest(".condition-field"),o=t.find("select.condition-value"),n=e.val()+"",i=t.data("selected_terms"),c=T(te).data("custom_tax_options"),a=c.filter(l=>l.slug==n),s=a.length?a[0].terms:[];if(o.val(null).find("option").remove(),!!s.length){for(let l of s){let{name:d,term_id:u}=l,r=new Option(d,u);o.append(r)}o.val(i).trigger("change")}}function et(){const e=T(this),t=e.closest(".condition-field"),o=t.find("select.condition-value"),n=e.val()+"";if(!n)return;const i=t.data("regions"),c=T(te).data("shipping_regions"),a=t.data("zones")[n].regions;if(o.val(null).find("option").remove(),!(typeof a!="object"||!a.length)){for(let s of a){const l=new Option(c[s],s);o.append(l)}o.val(i).trigger("change")}}function tt(){var e=T(this),t=T("select.non-qualifying-notice-type-field"),o=t.closest(".condition-settings-field");e.is(":checked")?(o.show(),t.prop("disabled",!1)):(o.hide(),t.prop("disabled",!0))}function H(e,t=""){t||(t="show");let o=t==="show"?"block":"none";jQuery(e).css("display",o)}function j(e){const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039"};return e.replace(/[&<>"']/g,o=>t[o])}function ot(){const{decimal_separator:e}=acfw_edit_coupon,t=jQuery(this);let o=t.val()+"";o=="0"+e&&t.val("0"),!(o=="0"||o.substring(0,2)=="0"+e)&&(o=o.replace(/^0+/,""),o=o.substring(0,1)==e?"0"+o:o,t.val(o))}function ge(e){return e=="<"?1:0}function Q(e,t){return e==t?"selected":""}function me(e,t){return e.indexOf(t)>=0?"selected":""}function Se(e=""){const{exactly:t,anyexcept:o,morethan:n,lessthan:i}=acfw_edit_coupon.condition_field_options;return'\n        <option value="=" '.concat(Q(e,"="),">").concat(t,'</option>\n        <option value="!=" ').concat(Q(e,"!="),">").concat(o,'</option>\n        <option value=">" ').concat(Q(e,">"),">").concat(n,'</option>\n        <option value="<" ').concat(Q(e,"<"),">").concat(i,"</option>\n    ")}function De(e){return/(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)}function re(e){const{decimal_separator:t}=acfw_edit_coupon;return parseFloat(e.replace(t,"."))}function Le(e,t){return e==="percent"||e==="fixed"?0<re(t):!0}function nt(e){return new RegExp(/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[0-9a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i).test(e)}function Qe(e=""){const{logic_field_options:t}=acfw_edit_coupon,{and:o,or:n}=t;return'\n        <div class="condition-group-logic">\n            <div class="field-control">\n                <select class="cgroup-logic">\n                    <option value="and" '.concat(Q(e,"and"),">").concat(o,'</option>\n                    <option value="or" ').concat(Q(e,"or"),">").concat(n,"</option>\n                </select>\n            </div>\n        </div>\n    ")}function ue(e=""){const{empty_cart_conditions_field:t}=acfw_edit_coupon,o=Ye(),n='<div class="empty-conditions">'.concat(t,"</div>");return'\n        <div class="condition-group '.concat(e?"":"new",'">\n            <a class="remove-condition-group" href="javascript:void(0);">\n                <i class="dashicons dashicons-trash"></i>\n            </a>\n            <div class="condition-group-fields">\n                ').concat(e||n,"\n            </div>\n            ").concat(o,"\n        </div>\n    ")}var D=jQuery;function it(){const e=document.querySelector("#acfw_cart_conditions .condition-data-wrap .condition-groups");D(e).find(".condition-group").length&&D(e).append(Qe("or")),D(e).find(".no-condition-group").remove(),D(e).append(ue()),D(this).blur(),D(e).find(".condition-group.new .add-condition-trigger").trigger("click"),D(e).find(".condition-group").removeClass("new"),O(!0)}function ct(){const e=D(this),t=document.querySelector("#acfw_cart_conditions"),o=e.closest(".condition-group"),n=o.index()==0?o.next(".condition-group-logic"):o.prev(".condition-group-logic"),{no_condition_group_msg:i}=acfw_edit_coupon;o.remove(),n.remove(),D(t).find(".condition-group").length<1&&D(t).find(".condition-groups").append('\n            <div class="no-condition-group">\n                '.concat(i,"\n            </div>\n        ")),O(!0)}function Te(e=""){const{logic_field_options:t}=acfw_edit_coupon,{and:o,or:n}=t;return'<div class="logic-condition-field condition-field" data-type="logic">\n        <div class="field-control">\n            <select class="condition-logic">\n                <option value="and" '.concat(Q(e,"and"),">").concat(o,'</option>\n                <option value="or" ').concat(Q(e,"or"),">").concat(n,"</option>\n            </select>\n        </div>\n    </div>")}const{cart_condition_fields:pe,condition_field_options:at}=acfw_edit_coupon;function st(e){const{value:t,condition:o,quantity:n}=e,{title:i,placeholder:c,field:a}=pe.product_category,{field:s}=pe.cart_quantity,{condition_label:l}=acfw_edit_coupon,{exactly:d,anyexcept:u,morethan:r,lessthan:w}=at,$=o||">";return'\n    <div class="product-category-field condition-field" data-type="product-category">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(i,'</h3>\n        <div class="field-control categories">\n            <label>').concat(a,'</label>\n            <select class="condition-value wc-enhanced-select" multiple data-placeholder="').concat(c,'">\n                ').concat(lt(t),'\n            </select>\n        </div>\n        <div class="field-control condition">\n            <label>').concat(l,'</label>\n            <select class="condition-select">\n                <option value="=" ').concat($=="="?"selected":"",">").concat(d,'</option>\n                <option value="!=" ').concat($=="!="?"selected":"",">").concat(u,'</option>\n                <option value=">" ').concat($==">"?"selected":"",">").concat(r,'</option>\n                <option value="<" ').concat($=="<"?"selected":"",">").concat(w,'</option>\n            </select>\n        </div>\n        <div class="field-control quantity">\n            <label>').concat(s,'</label>\n            <input type="number" class="condition-quantity" value="').concat(n,'" min="').concat(o=="<"?1:0,'">\n        </div>\n    </div>\n    ')}function lt(e=[]){const{options:t}=pe.product_category;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(me(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:Oe}=acfw_edit_coupon;function dt(e){const{title:t}=Oe.customer_logged_in_status;return'\n        <div class="customer-logged-in-status-field condition-field" data-type="customer-logged-in-status">\n\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n\n        <h3 class="condition-field-title">'.concat(t,'</h3>\n\n        <div class="field-control">\n            <select class="condition-value">\n                ').concat(rt(e),"\n            </select>\n        </div>\n    </div>")}function rt(e){const{options:t}=Oe.customer_logged_in_status;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(Q(n,e),">").concat(t[n],"</option>");return o}const{cart_condition_fields:ut}=acfw_edit_coupon;function pt(e){const{title:t,placeholder:o}=ut.customer_user_role;return'\n        <div class="customer-user-role-field condition-field" data-type="customer-user-role">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(t,'</h3>\n            <div class="field-control">\n                <select class="wc-enhanced-select condition-value" multiple data-placeholder="').concat(o,'">\n                    ').concat(_t(e),"\n                </select>\n            </div>\n        </div>\n    ")}function _t(e){const{user_role_options:t}=acfw_edit_coupon;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(me(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:ft}=acfw_edit_coupon;function gt(e){const{title:t,placeholder:o}=ft.disallowed_customer_user_role;return'\n        <div class="disallowed-customer-user-role-field condition-field" data-type="disallowed-customer-user-role">\n            <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n            <h3 class="condition-field-title">'.concat(t,'</h3>\n            <div class="field-control">\n                <select class="wc-enhanced-select condition-value" multiple data-placeholder="').concat(o,'">\n                    ').concat(mt(e),"\n                </select>\n            </div>\n        </div>\n    ")}function mt(e){const{user_role_options:t}=acfw_edit_coupon;let o="";for(let n in t)o+='<option value="'.concat(n,'" ').concat(me(e,n),">").concat(t[n],"</option>");return o}const{cart_condition_fields:ht}=acfw_edit_coupon;function vt(e){const{condition:t,value:o}=e,{title:n,desc:i,field:c}=ht.cart_quantity,{condition_label:a}=acfw_edit_coupon;return'\n    <div class="cart-quantity-field condition-field" data-type="cart-quantity">\n        <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n        <h3 class="condition-field-title">'.concat(n,"</h3>\n        <label>").concat(i,'</label>\n        <div class="field-control">\n            <label>').concat(a,'</label>\n            <select class="condition-select">\n                ').concat(Se(t),'\n            </select>\n        </div>\n        <div class="field-control">\n            <label>').concat(c,'</label>\n            <input class="condition-value" type="number" min="0" value="').concat(o>=0?o:"",'">\n        </div>\n    </div>\n    ')}function bt(e){const{condition:t,value:o,include_tax:n}=e,{cart_condition_fields:i,condition_label:c}=acfw_edit_coupon,{title:a,desc:s,field:l,tax_label:d}=i.cart_subtotal;return'\n    <div class="cart-subtotal-field condition-field" data-type="cart-subtotal">\n    <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n    <h3 class="condition-field-title">'.concat(a,"</h3>\n    <label>").concat(s,'</label>\n    <div class="field-control">\n      <label>').concat(c,'</label>\n      <select class="condition-select">\n        ').concat(Se(t),'\n      </select>\n    </div>\n    <div class="field-control">\n      <label>').concat(l,'</label>\n      <input class="condition-value wc_input_price" type="text" value="').concat(o||"",'">\n    </div>\n    <div class="field-control no-label">\n      <label><input type="checkbox" class="condition-include-tax" type="checkbox" ').concat(n==="yes"?"checked":""," /> ").concat(d,"</label>\n    </div>\n    </div>\n    ")}const{cart_condition_fields:yt}=acfw_edit_coupon;function wt(e,t){const o=t.replace(/-/g,"_"),{title:n}=yt[o],{cart_condition_field_premium_notice:i}=acfw_edit_coupon;return'\n  <div class="'.concat(t,' condition-field condition-field-premium" data-type="').concat(t,"\" data-premium='").concat(JSON.stringify(e),'\'>\n      <a class="remove-condition-field" href="javascript:void(0);"><i class="dashicons dashicons-trash"></i></a>\n      <h3 class="condition-field-title">').concat(n,'</h3>\n      <div class="field-control">\n          ').concat(i.label,"\n      </div>\n  </div>\n  ")}const K=jQuery,{cart_condition_premium_notice:ye,cart_condition_fields:we,upsell:$t}=acfw_edit_coupon;function xt(){const e=K(this),t=e.closest(".condition-group-actions").find("select.condition-types"),o=e.closest(".condition-group"),n=o.find(".condition-group-fields"),i=document.querySelector("#acfw_cart_conditions .acfw-overlay"),c=K("#acfw_cart_conditions").data("premium-conditions"),a=t.val()+"",s=n.find(".condition-field,.condition-set").length;if(H(i,"show"),c&&c.indexOf(a)>-1)vex.dialog.alert({unsafeMessage:$t.cart_condition_field});else{const l=Me(a,null,s);l?(n.find(".empty-conditions").remove(),n.show().append(l),n.find(".".concat(a,"-field")).find("input,select").trigger("change"),K("body").trigger("wc-enhanced-select-init"),O(!0)):vex.dialog.alert(acfw_edit_coupon.fail_add_condition_field)}H(i,"hide"),o.find(".condition-group-actions .add-condition-form").hide(),o.find(".condition-group-actions .add-condition-trigger").show()}function kt(){const e=K(this),t=e.closest(".condition-field,.condition-set"),o=t.closest(".condition-group"),n=t.index()==0?t.next(".logic-condition-field"):t.prev(".logic-condition-field"),{empty_cart_conditions_field:i}=acfw_edit_coupon;t.remove(),n.remove(),o.find(".condition-field,.condition-set").length<1&&o.find(".condition-group-fields").append('\n            <div class="empty-conditions">\n                '.concat(i,"\n            </div>\n        ")),O(!0)}function Me(e,t=null,o=0){let n="";switch(e){case"product-category":t=t||{},t.length&&(t={condition:">",value:t,quantity:0}),n+=st(t);break;case"customer-logged-in-status":n+=dt(t);break;case"customer-user-role":t=t||[],n+=pt(t);break;case"disallowed-customer-user-role":t=t||[],n+=gt(t);break;case"cart-quantity":t=t||{},n+=vt(t);break;case"cart-subtotal":t=t||{},n+=bt(t);break;default:const i=e.replace(/-/g,"_");if(we[i]){const{template_callback:c,default_data_value:a,title:s}=we[i];if(a&&(t=t||a),c&&(n+=c(t,i)),ye){let{label_premium:l}=ye;s&&s.includes(l)&&(t=t||{},n+=wt(t,e))}}break}return n&&o?Te()+n:n}function Ct(e){return acfw_edit_coupon.cart_conditon_field_options.indexOf(e)>-1}const A=jQuery,{cart_condition_premium_notice:$e,cart_condition_fields:xe}=acfw_edit_coupon;function qt(e){var n;const t=e.querySelectorAll(".condition-set,.condition-field");let o=[];return e.classList.contains("condition-group-logic")?{type:"group_logic",value:(n=e.querySelector("select"))==null?void 0:n.value}:(t.forEach(i=>o.push(Ft(i))),o.length?{type:"group",fields:o}:null)}function Ft(e){const{type:t}=e.dataset;let o={type:t,data:null},n,i,c;switch(t){case"logic":n=e.querySelector("select.condition-logic"),o.data=n.value;break;case"product-category":n=e.querySelector(".condition-value"),i=e.querySelector(".condition-select"),c=e.querySelector(".condition-quantity"),o.data={condition:A(i).val(),value:A(n).val(),quantity:A(c).val()};break;case"customer-logged-in-status":case"customer-user-role":case"disallowed-customer-user-role":n=e.querySelector(".condition-value"),o.data=A(n).val();break;case"cart-quantity":n=e.querySelector(".condition-select"),i=e.querySelector(".condition-value"),o.data={condition:A(n).val(),value:parseInt(A(i).val())};break;case"cart-subtotal":const a=e.querySelector("input.condition-include-tax");n=e.querySelector(".condition-select"),i=e.querySelector(".condition-value"),o.data={condition:A(n).val(),value:A(i).val(),include_tax:a.checked?"yes":"no"};break;default:const s=t==null?void 0:t.replace(/-/g,"_");if(xe[s]){const{scraper_callback:l,title:d}=xe[s];if(l&&(o.data=l(e)),$e){let{label_premium:u}=$e;if(d&&d.includes(u)){const{premium:r}=e.dataset;o.data=r?JSON.parse(r):""}}}break}return o}const q=jQuery,{post_id:jt}=woocommerce_admin_meta_boxes;function St(){const e=document.querySelector("#acfw_cart_conditions"),t=e.querySelectorAll(".condition-groups .condition-group, .condition-groups .condition-group-logic"),o=e.querySelector(".acfw-overlay"),{post_status:n}=acfw_edit_coupon,{post_id:i}=woocommerce_admin_meta_boxes;let c=[];if(q(e).find(".acfw-styled-table tr.add-edit-form button.cancel").trigger("click"),t.forEach(l=>{const d=qt(l);d&&c.push(d)}),!Qt(c)){vex.dialog.alert(acfw_edit_coupon.cart_conditions_invalid),q(e).addClass("save-error");return}const a={message:q(e).find(".text-input.non-qualifying-message-field").val(),btn_text:q(e).find(".text-input.non-qualifying-btn-text-field").val(),btn_url:q(e).find(".text-input.non-qualifying-btn-url-field").val(),notice_type:q(e).find(".non-qualifying-notice-type-field").val()},s=q(e).find(".display-notice-auto-apply-field").is(":checked")?"yes":"";if(a.btn_url&&!De(a.btn_url)){vex.dialog.alert(acfw_edit_coupon.cart_notice_url_invalid),q(e).addClass("save-error");return}H(o,"show"),Lt({cart_conditions:c,notice_settings:a,auto_apply_display:s,nonce:q(e).data("nonce")},l=>{l.status=="success"?n!=="publish"&&(q("input[name='post_title']").val()||q("input[name='post_title']").val("coupon-"+i),q("select[name='post_status']").append(new Option("Published","publish")).val("publish"),q("#publishing-action").append('\n                    <input type="hidden" name="publish" value="Publish">\n                '),q("input#publish").click()):l.error_msg&&vex.dialog.alert(l.error_msg),O(!1),q(e).find("#save-cart-conditions").prop("disabled",!0),H(o,"hide")})}function Dt(e){const t=document.querySelector("#acfw_cart_conditions");q(t).data("editing")&&(e.preventDefault(),q(t).find("#save-cart-conditions").trigger("click"),setTimeout(()=>{q(t).hasClass("save-error")?q(t).removeClass("save-error"):q("form#post").submit()},1e3))}function Lt(e,t){return e.action="acfw_save_cart_conditions",e.coupon_id=jt,q.post(ajaxurl,e,t,"json")}function Qt(e){var u;let t,o,n,i,c,a,s,l;if(e.length===1&&((u=e[0].fields)==null?void 0:u.length)<1)return!0;let d="";for(t of e){if(t.type==="group_logic"){if(!d||d==="group_logic")return!1;d="group_logic";continue}if(d=t.type,t.fields===void 0||t.fields.length<1)return!1;for(o of t.fields)if(i=o.type,n=o.data,n===void 0||n===""||n===null||(typeof n=="object"&&typeof n.length=="number"?c=n:i==="product-category"?(c=n.value,a=n.condition,s=n.quantity):typeof n=="object"&&n.length===void 0?(c=n.products,a=n.condition,s=n.value):s=n,l=ge(a),c!==void 0&&c.length<1||a!==void 0&&!a||!Number.isInteger(s)&&s!==void 0&&!s||Number.isInteger(s)&&s<l||typeof s=="number"&&s<l))return!1}return!0}const B=jQuery,{product_table_buttons:Tt,condition_field_options:Ot,bogo_form_fields:Mt}=acfw_edit_coupon;function It(){const e=B(this),t=e.closest(".acfw-styled-table"),o=t.find("tbody"),n=t.data("exclude");o.find("tr.no-result").remove(),o.append(Ae(n)),B("body").trigger("wc-enhanced-select-init")}function At(){const e=B(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=t.find("td.product").data("product");let c=o.data("exclude");c.splice(c.indexOf(i.product_id),1),n.find("tr.no-result").remove(),t.replaceWith(Ae(c,i)),o.data("exclude",c),o.find(".wc-product-search").data("exclude",c),B("body").trigger("wc-enhanced-select-init")}function Nt(){const e=B(this),t=e.closest("tr"),o=e.closest("table.acfw-styled-table"),n=t.find(".wc-product-search"),i=t.find(".condition-select"),c=t.find(".condition-quantity"),a=i.val()==="<"?1:0;let s=o.data("exclude");if(!n.val()||!i.val()||!c.val()||parseInt(c.val())<a){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}const l=parseInt(n.val());if(s.includes(l)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}const d={product_id:l,condition:i.val(),quantity:parseInt(c.val()+""),product_label:n.find("option:selected").text(),condition_label:i.find("option:selected").text()};let u='\n        <tr>\n            <td class="product" data-product="'.concat(j(JSON.stringify(d)),'">').concat(d.product_label,'</td>\n            <td class="condition">').concat(d.condition_label,'</td>\n            <td class="quantity">').concat(d.quantity,'</td>\n            <td class="actions">\n                <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n                <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n            </td>\n        </tr>\n    ');s.push(d.product_id),t.replaceWith(u),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),O(!0)}function Et(){const e=jQuery(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=t.find("td.product").data("product"),c=t.find("td").length;let a=o.data("exclude");if(a.includes(i.product_id)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}if(typeof i=="object"){const{product_id:s,product_label:l,condition_label:d,quantity:u}=i;let r='\n            <tr>\n                <td class="product" data-product="'.concat(j(JSON.stringify(i)),'">').concat(l,'</td>\n                <td class="condition">').concat(d,'</td>\n                <td class="quantity">').concat(u,'</td>\n                <td class="actions">\n                    <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n                    <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n                </td>\n            </tr>\n        ');a.push(s),t.replaceWith(r),o.data("exclude",a),o.find(".wc-product-search").data("exclude",a)}else t.remove(),Ie(n,c)}function Ht(){const e=jQuery(this),t=e.closest("tr"),o=t.closest("table"),n=o.find("tbody"),i=t.find("td").length;t.remove();let c=t.find("td.product").data("product"),a=o.data("exclude"),s=a.indexOf(parseInt(c.product_id));s!==-1&&a.splice(s,1),o.data("exclude",a),o.find(".wc-product-search").data("exclude",a),Ie(n,i),O(!0)}function Ie(e,t=3){e.find("tr").length>0||e.append('\n        <tr class="no-result">\n            <td colspan="'.concat(t,'">').concat(acfw_edit_coupon.no_products_added,"</td>\n        </tr>\n    "))}function Ae(e=[],t=!1){let o="",n="";if(typeof t=="object"){const{product_id:k,product_label:L}=t;o='<option value="'.concat(k,'">').concat(L,"</option>"),n=t.condition}const{add:i,edit:c,cancel:a}=Tt,{exactly:s,anyexcept:l,morethan:d,lessthan:u}=Ot,{type_to_search:r}=Mt,w=typeof t=="object"?c:i;return'\n        <tr class="add-edit-form adding">\n            <td class="product" data-product="'.concat(typeof t=="object"?j(JSON.stringify(t)):0,'">\n                <div class="object-search-wrap">\n                    <select class="product-in-cart wc-product-search"\n                        data-placeholder="').concat(r,'"\n                        data-action="acfw_search_products"\n                        data-exclude="').concat(j(JSON.stringify(e)),'">').concat(o,'</select>\n                </div>\n            </td>\n            <td class="condition">\n                <select class="condition-select">\n                    <option value="=" ').concat(n=="="?"selected":"",">").concat(s,'</option>\n                    <option value="!=" ').concat(n=="!="?"selected":"",">").concat(l,'</option>\n                    <option value=">" ').concat(n==">"?"selected":"",">").concat(d,'</option>\n                    <option value="<" ').concat(n=="<"?"selected":"",">").concat(u,'</option>\n                </select>\n            </td>\n            <td class="quantity">\n                <input type="number" class="condition-quantity" value="').concat(typeof t=="object"?t.quantity:1,'" min="').concat(n=="<"?1:0,'">\n            </td>\n            <td class="actions">\n                <button type="button" class="condition-product-add button-primary">').concat(w,'</button>\n                <button type="button" class="cancel button">').concat(a,"</button>\n            </td>\n        </tr>\n        ")}const R=jQuery;function Vt(){const e=R(this),t=parseInt(e.attr("min"));parseFloat(e.val()+"")<t&&e.val(t)}function Pt(){const e=R(this),t=e.closest(".condition-field,.condition-set"),o=t.data("type"),n=o=="product-quantity"||o=="has-ordered-before"||o=="product-category"?"input.condition-quantity":"input.condition-value",i=t.find(n),c=e.val()+"";let a=ge(c);i.attr("min",a).trigger("change")}function zt(){const{within_a_period_label:e,number_of_orders_label:t}=acfw_edit_coupon,o=R(this),n=o.closest(".cart-quantity-field"),i=n.find(".condition-type-value label");o.val()=="within-a-period"?i.text(e):i.text(t)}function Jt(){const e=R(this),t=e.closest(".condition-field"),o=t.find("select.condition-select"),n=o.val()+"";let i=e.val()+"",c=ge(n);acfw_edit_coupon.decimal_separator!=="."&&(i=i.replace(acfw_edit_coupon.decimal_separator,".")),!(!o||parseFloat(i)>c-1)&&e.val(c)}function Rt(){const e=R(this);let t=e.val();t=="0"+acfw_edit_coupon.decimal_separator&&e.val("0"),!(t=="0"||t.substring(0,2)=="0"+acfw_edit_coupon.decimal_separator)&&(t=t.replace(/^0+/,""),t=t.substring(0,1)==acfw_edit_coupon.decimal_separator?"0"+t:t,e.val(t))}function Ut(){const e=R(this),t=e.closest(".condition-field"),o=t.find("select.condition-select"),n=t.find("input.condition-value");switch(e.val()){case"string":n.prop("type","text"),n.removeClass("wc_input_price"),(o.val()==">"||o.val()=="<")&&o.val("="),o.find("option[value='>'],option[value='<']").prop("disabled",!0);break;case"number":n.prop("type","number"),n.removeClass("wc_input_price"),o.find("option[value='>'],option[value='<']").prop("disabled",!1);break;case"price":n.prop("type","text"),n.addClass("wc_input_price"),o.find("option[value='>'],option[value='<']").prop("disabled",!1);break}o.trigger("change")}function Bt(){window.acfw_edit_coupon_triggers=window.acfw_edit_coupon_triggers||{},window.acfw_edit_coupon_triggers.remove_all_premium_condition=()=>{jQuery(".condition-field-premium .remove-condition-field").each(function(){jQuery(this).trigger("click")}),jQuery(".condition-notice").remove(),jQuery(".empty-conditions").each(function(){jQuery(this).closest(".condition-group").find(".remove-condition-group").trigger("click")})}}const Wt=(e,t)=>{const{cart_condition_premium_notice:o}=acfw_edit_coupon;if(!o)return{};let n={};for(const[i,c]of Object.entries(t))if(c.type!=="group_logic")for(let[a,s]of Object.entries(c.fields)){let l=Object.entries(e).find(([d,u])=>u.key===s.type);if(l){let[d,u]=l,{label_premium:r}=o;u.title.includes(r)&&(n[d]=u)}}return n},Gt=(e,t)=>{const{cart_condition_premium_notice:o}=acfw_edit_coupon;let n=[],i="";i='<div class="condition-notice">',i+='<a id="remove-all-premium-condition" href="javascript:void(0);" onclick="acfw_edit_coupon_triggers.remove_all_premium_condition()"><i class="dashicons dashicons-trash"></i></a>',i+='<img src="'.concat(o.logo_img,'">');let{label_premium:c}=o;return Object.keys(t).map(a=>{let s=t[a];n.push("<b>".concat(s.title.replace(" (".concat(c,")"),""),"</b>"))}),o.label.map(a=>{a=n.length&&a.includes("{{premium}}")?a.replace("{{premium}}",n.join(", ")):a,i+="<p>".concat(a,"</p>")}),i+='<div class="action-wrap">',o.actions.map(a=>{let s=a.url.includes("action=")?"":"target='_blank'";i+='<a href="'.concat(a.url,'" ').concat(s,' class="action-button primary">').concat(a.label,"</a>")}),i+="</div>",i+="</div>",i};function Yt(e){const{cart_condition_fields:t}=acfw_edit_coupon;let o="";if(e.length){let n=Wt(t,e);Object.keys(n).length&&(o+=Gt(t,n),Bt())}return o}const Ne=jQuery;function Zt(){const e=Ne(this),t=e.closest(".woocommerce").find("#acfw_cart_conditions"),o=e.data("tab");t.find(".panel").hide(),t.find('.panel[data-tab="'.concat(o,'"]')).show(),Kt(e)}function Kt(e){Ne(".acfw-cart-condition-tabs li").removeClass("active"),e.closest("li").addClass("active")}const g=jQuery,b=document.querySelector("#acfw_cart_conditions");function Xt(){g(b).on("click","#add-cart-condition-group",it),g(b).on("click","a.remove-condition-group",ct),g(b).on("click",".add-condition-field",xt),g(b).on("click","a.remove-condition-field",kt),g(b).on("click",".add-condition-trigger",be),g(b).on("click",".cancel-add-condition-field",be),g(b).on("click",".acfw-styled-table tfoot .add-table-row",It),g(b).on("click",".acfw-styled-table td.actions a.edit",At),g(b).on("click","tr.add-edit-form .actions .condition-product-add",Nt),g(b).on("click","tr.add-edit-form .actions .cancel",Et),g(b).on("click",".acfw-styled-table td.actions a.remove",Ht),g(b).on("click","#save-cart-conditions",St),g(b).on("change","input[type='number']",Vt),g(b).on("change","select.condition-select",Pt),g(b).on("change","select.has-ordered-before-type",zt),g(b).on("change",".wc_input_price",Jt),g(b).on("change","select.custom-taxonomy",Xe),g(b).on("change",".shipping-zone-region-field select.condition-select",et),g(b).on("blur",".wc_input_price",Rt),g(b).on("change","select.value-type",Ut),g("form#post").on("submit",Dt),g(b).find("select").trigger("change"),g(b).css("min-height",g("#coupon_options").height()),g(b).on("change","input,select,textarea",()=>{O(!0)}),g(b).find(".condition-groups").each(function(){g(this).find(".condition-group-fields").length&&g(this).show()}),g(".acfw-cart-condition-tabs").on("click","li a",Zt),g(b).on("change","input.display-notice-auto-apply-field",tt),g(b).find("input.display-notice-auto-apply-field").trigger("change"),setTimeout(eo,500)}function eo(){const e=b.querySelector(".condition-groups"),t=g(b).data("cart_conditions");(async()=>{let n="";if(n+=Yt(t),t.length)for(let i of t)if(i.type=="group"){const c=to(i.fields);n+=ue(c)}else n+=Qe(i.value);else n=ue();g(e).html(n),g(e).find("input,select").trigger("change"),g(e).find(".condition-group.new .add-condition-trigger").trigger("click"),g(e).find(".condition-group").removeClass("new")})().then(()=>{setTimeout(()=>g("body").trigger("wc-enhanced-select-init"),1500),O(!1)})}function to(e){let t="",o="",n=!0;for(let i of e){const{type:c,data:a}=i;if(!Ct(c)){n=!1;continue}if(c=="logic"){o=n?Te(a):"";continue}const s=Me(c,a);s?(t+=o+s,n=!0):n=!1,o=""}return t}function ce(){const{upsell:e}=acfw_edit_coupon;return e?'\n  <div class="upsell">\n    '.concat(e.bogo_deals_type,"\n  </div>"):""}function oo(e,t=!1){const{products:o,quantity:n,discount_type:i,discount_value:c}=e,{bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{quantity:l,products:d,price_discount:u,type_to_search:r}=a,w=i?e.discount_type:"override",$=t?no(w,c):"",k=t?'<th class="price">'.concat(u,"</th>"):"",L=io(o),I=t?"".concat(s.combination_get," ").concat(s.combination_get_2):s.combination_buy;return'\n      <p class="instructions">'.concat(I,'</p>\n      <table class="acfw-styled-table combined-objects-form" \n          data-combined="').concat(j(JSON.stringify(e)),'"\n          data-isdeals="').concat(t,'"\n          data-type="product">\n          <thead>\n              <tr>\n                  <th class="objects-list">').concat(d,'</th>\n                  <th class="quantity">').concat(l,"</th>\n                  ").concat(k,'\n              </tr>\n          </thead>\n          <tbody>\n              <tr>\n                  <td class="objects-list object">\n                      <select class="combined-products-list wc-product-search"\n                      data-placeholder="').concat(r,'"\n                      data-action="acfw_search_products"\n                      data-exclude="" multiple>').concat(L,'</select>\n                  </td>\n                  <td class="quantity">\n                      <input type="number" class="condition-quantity" value="').concat(n,'" min="1">\n                  </td>\n                  ').concat($,"\n              </tr>\n          </tbody>\n      </table>\n      ").concat(ce(),"\n    ")}function no(e,t="0"){const{currency_symbol:o,discount_field_options:n}=acfw_edit_coupon,{override:i,percent:c,fixed:a}=n;return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(e=="override"?"selected":"",">").concat(o," : ").concat(i,'</option>\n            <option value="percent" ').concat(e=="percent"?"selected":"",">% : ").concat(c,'</option>\n            <option value="fixed" ').concat(e=="fixed"?"selected":"",">-").concat(o," : ").concat(a,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(t,'">\n        </div>\n    </td>\n    ')}function io(e){if(typeof e!="object"||!e.length)return"";let t="";for(let o of e)t+='<option value="'.concat(o.product_id,'" selected>').concat(o.label,"</option>");return t}function co(e,t=!1){const{categories:o,quantity:n,discount_type:i,discount_value:c}=e,{bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{quantity:l,categories:d,price_discount:u,type_to_search:r}=a,w=i?e.discount_type:"override",$=t?ao(w,c):"",k=t?'<th class="price">'.concat(u,"</th>"):"",L=so(o),I=t?"".concat(s.categories_get):s.categories_buy;return'\n      <p class="instructions">'.concat(I,'</p>\n      <table class="acfw-styled-table combined-objects-form" \n          data-combined="').concat(j(JSON.stringify(e)),'"\n          data-isdeals="').concat(t,'"\n          data-type="category">\n          <thead>\n              <tr>\n                  <th class="objects-list">').concat(d,'</th>\n                  <th class="quantity">').concat(l,"</th>\n                  ").concat(k,'\n              </tr>\n          </thead>\n          <tbody>\n              <tr>\n                  <td class="objects-list object">\n                      <select class="product-categories-list wc-product-search"\n                      data-placeholder="').concat(r,'"\n                      data-action="acfw_search_product_category"\n                      data-exclude="" multiple>').concat(L,'</select>\n                  </td>\n                  <td class="quantity">\n                      <input type="number" class="condition-quantity" value="').concat(n,'" min="1">\n                  </td>\n                  ').concat($,"\n              </tr>\n          </tbody>\n      </table>\n      ").concat(ce(),"\n    ")}function ao(e,t="0"){const{currency_symbol:o,discount_field_options:n}=acfw_edit_coupon,{override:i,percent:c,fixed:a}=n;return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(e=="override"?"selected":"",">").concat(o," : ").concat(i,'</option>\n            <option value="percent" ').concat(e=="percent"?"selected":"",">% : ").concat(c,'</option>\n            <option value="fixed" ').concat(e=="fixed"?"selected":"",">-").concat(o," : ").concat(a,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(t,'">\n        </div>\n    </td>\n    ')}function so(e){if(typeof e!="object"||!e.length)return"";let t="";for(let o of e)t+='<option value="'.concat(o.category_id,'" selected>').concat(o.label,"</option>");return t}function Ee(e){const{product_id:t,product_label:o}=e;return'\n    <td class="product product-'.concat(t,' object" data-product="').concat(j(JSON.stringify(e)),'">\n        ').concat(o,"\n    </td>\n    ")}function W(e=3,t="product"){const{no_products_added:o,no_categories_added:n}=acfw_edit_coupon;return'\n    <tr class="no-result">\n        <td colspan="'.concat(e,'">').concat(t=="category"?n:o,"</td>\n    </tr>\n    ")}function lo(e,t,o=!1){const{add_product_label:n,bogo_form_fields:i,bogo_instructions:c}=acfw_edit_coupon,{quantity:a,product:s}=i,l=o?"".concat(c.specific_get):c.specific_buy,d=o?4:3,u=o?'<th class="price">Price/Discount</th>':"";let r="",w=[];if(e.length>=1&&t=="specific-products")for(let k of e){let{quantity:L,discount_type:I,discount_value:P}=k,G=o?ro(I,P):"";w.push(k.product_id),r+="\n        <tr>\n          ".concat(Ee(k),'\n          <td class="quantity">').concat(L,"</td>\n          ").concat(G,'\n          <td class="actions">\n            <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n            <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n          </td>\n        </tr>\n      ')}else r=W(d);return'\n    <p class="instructions">'.concat(l,'</p>\n    <table class="product-quantity-condition-table acfw-styled-table" \n      data-type="product" data-exclude="').concat(j(JSON.stringify(w)),'" \n      data-isdeals="').concat(o,'">\n      <thead>\n        <tr>\n          <th class="product">').concat(s,'</th>\n          <th class="quantity">').concat(a,"</th>\n          ").concat(u,'\n          <th class="actions"></th>\n        </tr>\n      </thead>\n      <tbody>').concat(r,'</tbody>\n      <tfoot>\n        <tr>\n          <td colspan="').concat(d,'">\n            <a class="add-table-row" href="javascript:void(0);">\n              <i class="dashicons dashicons-plus"></i>\n              ').concat(n,"\n            </a>\n          </td>\n        </tr>\n      </tfoot>\n    </table>\n  ")}function ro(e="override",t="0"){return'<td class="price">\n    ('.concat(e,") ").concat(t,"\n  </td>")}function uo(e,t=!1){return t?_o(e):po(e)}function po(e){const{quantity:t}=e,{bogo_instructions:o,bogo_form_fields:n}=acfw_edit_coupon;return'\n    <p class="instructions">'.concat(o.anyproducts_buy,'</p>\n    <div class="any-products-trigger-form any-products-form" data-anyproducts="').concat(j(JSON.stringify(e)),'">\n      <div class="trigger-field-row trigger-quantity-field-row">\n        <label for="any_products_trigger_qty">').concat(n.trigger_quantity,'</label>\n        <input type="number" id="any_products_trigger_qty" class="condition-quantity" value="').concat(t!=null?t:"1",'" min="1" />\n      </div>\n    </div>\n    ').concat(ce(),"\n  ")}function _o(e){const{quantity:t,discount_type:o,discount_value:n}=e,{currency_symbol:i,discount_field_options:c,bogo_form_fields:a,bogo_instructions:s}=acfw_edit_coupon,{override:l,percent:d,fixed:u}=c,{quantity:r,price_discount:w,discount_type:$}=a,k=o?e.discount_type:"override";return'\n    <p class="instructions">'.concat(s.anyproducts_get,'</p>\n    <table class="acfw-styled-table any-products-apply-form any-products-form" data-anyproducts="').concat(j(JSON.stringify(e)),'">\n      <thead>\n        <tr>\n          <th class="quantity">').concat(r,'</th>\n          <th class="type">').concat($,'</th>\n          <th class="price">').concat(w,'</th>\n        </tr>\n      </thead>\n      <tbody>\n        <tr>\n          <td class="quantity object">\n            <input type="number" class="condition-quantity" value="').concat(t!=null?t:"1",'" min="1">\n          </td>\n          <td class="type">\n            <select class="discount_type">\n              <option value="override" ').concat(k=="override"?"selected":"",">").concat(i," : ").concat(l,'</option>\n              <option value="percent" ').concat(k=="percent"?"selected":"",">% : ").concat(d,'</option>\n              <option value="fixed" ').concat(k=="fixed"?"selected":"",">-").concat(i," : ").concat(u,'</option>\n            </select>\n          </td>\n          <td class="price">\n            <input type="text" class="discount_value short wc_input_price" value="').concat(n!=null?n:"0",'">\n          </td>\n        </tr>\n      </tbody>\n    </table>\n    ').concat(ce(),"\n  ")}const S=jQuery,z=document.querySelector("#acfw_bogo_deals");function M(e){S(z).data("editing",e),S(z).find("#save-bogo-deals").prop("disabled",!e)}function fo(e){const t=S(this),o=t.data("block"),n=z.querySelector(".bogo-conditions-block"),i=z.querySelector(".bogo-product-deals-block"),c=S(z).data("bogo_deals"),a=c.conditions?c.conditions:null,s=c.deals?c.deals:null,l=o=="conditions"?c.conditions_type:c.deals_type;let d=null;o==="conditions"?d=c.conditions_type==t.val()?a:d:d=c.deals_type==t.val()?s:d;const u=o=="deals";let r=!1,w,$;switch(t.val()){case"combination-products":w=oo(d!=null?d:{},u),r=!0;break;case"product-categories":w=co(d!=null?d:[],u),r=!0;break;case"any-products":w=uo(d!=null?d:{},u),r=!0;break;case"specific-products":default:w=lo(d!=null?d:{},l,u),r=!1;break}if(o=="conditions")S(n).html(w).find("input.condition-quantity").trigger(e.type==="change"?"change":"acfw_fetch_data"),$=n;else{const k=S(z).find(".multiple-items-desc");t.val()!=="specific-products"?k.show():k.hide(),S(i).html(w).find("input.condition-quantity").trigger(e.type==="change"?"change":"acfw_fetch_data"),$=i}r&&acfw_edit_coupon.upsell!==void 0?S($).addClass("premium-only"):S($).removeClass("premium-only"),S("body").trigger("wc-enhanced-select-init"),S("body").trigger("init_tooltips")}function go(){const e=S(this),t=e.closest("#acfw_bogo_deals");e.val()==="repeat"?(t.find(".repeat-limit-field-wrap").addClass("show"),t.find("#bogo-repeat-limit").prop("disabled",!1)):(t.find(".repeat-limit-field-wrap").removeClass("show"),t.find("#bogo-repeat-limit").prop("disabled",!0))}const f=jQuery,x=document.querySelector("#acfw_bogo_deals"),{post_id:oe}=woocommerce_admin_meta_boxes;function mo(){var P,G;f("#acfw_bogo_deals").find(".acfw-styled-table tr.add-edit-form button.cancel").trigger("click");const{post_status:e,upsell:t}=acfw_edit_coupon,o=x.querySelectorAll(".bogo-conditions-block table.acfw-styled-table tbody td.object,.bogo-conditions-block .any-products-trigger-form"),n=x.querySelectorAll(".bogo-product-deals-block table.acfw-styled-table tbody td.object"),i=x.querySelector(".acfw-overlay"),c=x.querySelector("input[name='bogo_type']:checked"),a=f(x).find("#bogo-condition-type").val(),s=f(x).find("#bogo-deals-type").val(),l=parseInt(f(x).find("#bogo-repeat-limit").val()),d=f(x).find(".notice-option"),u=ke(o,a),r=ke(n,s),w=c?c.value:null;let $=!1,k=!1;if(a==="any-products"&&($=(u==null?void 0:u.quantity)<1),s==="any-products"&&(k=!(r!=null&&r.discount_type)||!(r!=null&&r.discount_value)||(r==null?void 0:r.quantity)<1),a==="combination-products"&&($=!((P=u==null?void 0:u.products)!=null&&P.length)||(u==null?void 0:u.quantity)<1),s==="combination-products"&&(k=!((G=r==null?void 0:r.products)!=null&&G.length)||!(r!=null&&r.discount_type)||!(r!=null&&r.discount_value)||(r==null?void 0:r.quantity)<1),(u==null?void 0:u.length)<1||(r==null?void 0:r.length)<1||!w||$||k){vex.dialog.alert(acfw_edit_coupon.bogo_deals_save_error_msg),f(x).addClass("save-error");return}if(t!==void 0&&(a!=="specific-products"||s!=="specific-products")){vex.dialog.alert(acfw_edit_coupon.bogo_deals_save_error_msg),f(x).addClass("save-error");return}if(["any-products","combination-products"].includes(s)&&!Le(r==null?void 0:r.discount_type,r==null?void 0:r.discount_value)){vex.dialog.alert(acfw_edit_coupon.discount_type_value_error_msg),f(x).addClass("save-error");return}const L={message:d.find("textarea[name='acfw_bogo_notice_message_text']").val(),button_text:d.find("input[name='acfw_bogo_notice_button_text']").val(),button_url:d.find("input[name='acfw_bogo_notice_button_url']").val(),notice_type:d.find("select[name='acfw_bogo_notice_type']").val()};H(i,"show"),f(x).trigger("save_bogo_deals");const I={conditions:u,deals:r,conditions_type:a,deals_type:s,repeat_limit:l,type:w,notice_settings:L,nonce:f(x).data("nonce")};f.post(ajaxurl,{action:"acfw_save_bogo_deals",coupon_id:oe,...I},ae=>{ae.status=="success"?(f(x).data("bogo_deals",I),e!=="publish"&&(f("input[name='post_title']").val()||f("input[name='post_title']").val("coupon-"+oe),f("select[name='post_status']").append(new Option("Published","publish")).val("publish"),f("#publishing-action").append('\n                    <input type="hidden" name="publish" value="Publish">\n                '),f("input#publish").click())):ae.error_msg&&vex.dialog.alert(ae.error_msg),f(x).find("#clear-bogo-deals").prop("disabled",!1),M(!1),H(i,"hide")},"json")}function ke(e,t){let o=[],n;switch(t){case"any-products":o=f(e).closest(".any-products-form").data("anyproducts");break;case"combination-products":case"product-categories":o=f(e).closest("table.combined-objects-form").data("combined");break;case"specific-products":default:e.forEach(i=>{n=jQuery(i).data("product"),n&&o.push(n)});break}return o}function ho(){const e=f(this);if(!confirm(e.data("prompt")))return;const t=x.querySelector(".bogo-conditions-block table.acfw-styled-table tbody"),o=x.querySelector(".bogo-product-deals-block table.acfw-styled-table tbody"),n=x.querySelector(".acfw-overlay"),i=x.querySelector("input[name='bogo_type']:checked");H(n,"show"),f.post(ajaxurl,{action:"acfw_clear_bogo_deals",coupon_id:oe,_wpnonce:e.data("nonce")},c=>{c.status=="success"?(f(t).html(W(3)),f(o).html(W(4)),f(i).prop("checked",!1),e.prop("disabled",!0),M(!1),f("#post-status-display").text()!="Published"&&(f("input[name='post_title']").val()||f("input[name='post_title']").val("coupon-"+oe),f("input#publish").click())):c.error_msg&&vex.dialog.alert(c.error_msg),H(n,"hide")},"json")}function vo(){const e=f(this).closest("table.combined-objects-form"),t=e.data("combined"),o=e.find(".wc-product-search option:selected"),n=parseInt(e.find("input.condition-quantity").val()+""),i=e.data("type").toString(),c=i==="category"?{categories:[],quantity:n}:{products:[],quantity:n};if(e.data("isdeals")){const d=e.find("select.discount_type"),u=e.find("input.discount_value"),r=parseFloat(u.val());if(r<0||isNaN(r)){u.val(t?t.discount_value:""),vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}else c.discount_type=d.val(),c.discount_value=u.val()}let s,l;for(l=0;l<o.length;l++)s=f(o[l]),i==="category"?c.categories.push({category_id:s.val(),label:s.text()}):c.products.push({product_id:s.val(),label:s.text()});e.data("combined",c),M(!0)}function bo(e){f(x).data("editing")&&(e.preventDefault(),f(x).find("#save-bogo-deals").trigger("click"),setTimeout(()=>{f(x).hasClass("save-error")?f(x).removeClass("save-error"):f("form#post").submit()},1e3))}function yo(e){const t=f(this).closest(".any-products-trigger-form"),o=parseInt(t.find("input#any_products_trigger_qty").val()),n={quantity:o&&!isNaN(o)?o:0};t.data("anyproducts",n),e.type==="change"&&M(!0)}function wo(e){const t=f(this).closest(".any-products-apply-form"),o=parseInt(t.find("input.condition-quantity").val()),n=t.find("select.discount_type").val().toString(),i=t.find("input.discount_value").val().toString(),c={quantity:o&&!isNaN(o)?o:0,discount_type:n!=null?n:"",discount_value:i!=null?i:""};t.data("anyproducts",c),e.type==="change"&&M(!0)}function He(e,t,o,n=!1){const{type_to_search:i}=acfw_edit_coupon.bogo_form_fields,{add:c,edit:a,cancel:s}=acfw_edit_coupon.product_table_buttons,{quantity:l}=n,d=typeof n=="object"?$o(e,n):"",u=o?xo(n):"",r=typeof n=="object"?a:c;return'\n    <tr class="add-edit-form adding">\n        <td class="product" data-object="'.concat(typeof n=="object"?j(JSON.stringify(n)):0,'">\n            <div class="object-search-wrap">\n                <select class="').concat(e=="category"?"product-category-in-cart":"product-in-cart",' wc-product-search"\n                    data-placeholder="').concat(i,'"\n                    data-action="').concat(e=="category"?"acfw_search_product_category":"acfw_search_products",'"\n                    data-exclude="').concat(j(JSON.stringify(t)),'">').concat(d,'</select>\n            </div>\n        </td>\n        <td class="quantity">\n            <input type="number" class="condition-quantity" value="').concat(typeof n=="object"?l:1,'" min="1">\n        </td>\n        ').concat(u,'\n        <td class="actions">\n            <button type="button" class="condition-product-add button-primary">').concat(r,'</button>\n            <button type="button" class="cancel button">').concat(s,"</button>\n        </td>\n    </tr>\n    ")}function $o(e,t){const{category_id:o,product_id:n,category_label:i,product_label:c}=t,a=e=="category"?o:n,s=e=="category"?i:c;return'<option value="'.concat(a,'">').concat(s,"</option>")}function xo(e){const{currency_symbol:t,discount_field_options:o}=acfw_edit_coupon,{override:n,percent:i,fixed:c}=o,{discount_type:a,discount_value:s}=e,l=typeof e=="object"&&s?s:"0";return'\n    <td class="price">\n        <div>\n        <select class="discount_type">\n            <option value="override" '.concat(a=="override"?"selected":"",">").concat(t," : ").concat(n,'</option>\n            <option value="percent" ').concat(a=="percent"?"selected":"",">% : ").concat(i,'</option>\n            <option value="fixed" ').concat(a=="fixed"?"selected":"",">-").concat(t," : ").concat(c,'</option>\n        </select>\n        <input type="text" class="discount_value short wc_input_price" value="').concat(l,'">\n        </div>\n    </td>\n    ')}function ko(e){const{category_id:t,category_label:o}=e;return'\n    <td class="category category-'.concat(t,' object" data-category="').concat(j(JSON.stringify(e)),'">\n        ').concat(o,"\n    </td>\n    ")}function Ve(e,t,o){const{quantity:n,discount_type:i,discount_value:c}=e,a=o?'<td class="price">('.concat(i,") ").concat(c,"</td>"):"";return"\n    <tr>\n      ".concat(Co(e,t),'\n      <td class="quantity">').concat(n,"</td>\n      ").concat(a,'\n      <td class="actions">\n        <a class="edit" href="javascript:void(0)"><span class="dashicons dashicons-edit"></span></a>\n        <a class="remove" href="javascript:void(0)"><span class="dashicons dashicons-no"></span></a>\n      </td>\n    </tr>')}function Co(e,t){switch(t){case"category":return ko(e);case"product":return Ee(e)}return""}const J=jQuery;acfw_edit_coupon;function qo(){const e=J(this),t=e.closest(".acfw-styled-table"),o=t.find("tbody"),n=t.data("isdeals"),i=t.data("type"),c=t.data("exclude");o.find("tr.no-result").remove(),o.append(He(i,c,n)),J("body").trigger("wc-enhanced-select-init"),o.find("tr.add-edit-form select.enhanced").trigger("focus")}function Fo(){const e=jQuery(this),t=e.closest("tr"),o=e.closest(".acfw-styled-table"),n=o.find("tbody"),i=o.data("isdeals"),c=o.data("type"),a=t.find(".object").data(c),{category_id:s,product_id:l}=a,d=o.data("exclude"),u=c=="category"?s:l;d.splice(d.indexOf(u),1),n.find("tr.no-result").remove(),t.replaceWith(He(c,d,i,a)),o.data("exclude",d),o.find(".wc-product-search").data("exclude",d),J("body").trigger("wc-enhanced-select-init")}function jo(){const e=J(this),t=e.closest("tr"),o=e.closest("table"),n=t.closest("tbody"),i=o.data("isdeals"),c=t.find("td").length,a=o.data("type"),s=t.find("td.product").data("object"),{category_id:l,product_id:d}=s,u=o.data("exclude"),r=a=="category"?l:d;if(u.includes(r)){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}typeof s=="object"?(u.push(r),t.replaceWith(Ve(s,a,i)),o.data("exclude",u),o.find(".wc-product-search").data("exclude",u)):(t.remove(),n.find("tr").length<=0&&n.append(W(c,a)))}function So(){const e=J(this),t=e.closest("tr"),o=e.closest("table.acfw-styled-table"),n=o.data("isdeals"),i=o.data("type"),c=t.find(".wc-product-search"),a=t.find(".condition-quantity"),s=o.data("exclude");if(!c.val()||!a.val()||a.val()<1){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}if(s.includes(parseInt(c.val()))){vex.dialog.alert(acfw_edit_coupon.product_exists_in_table);return}if(n){const r=t.find("input.discount_value").val();if(!Le(t.find("select.discount_type").val(),r)){vex.dialog.alert(acfw_edit_coupon.discount_type_value_error_msg);return}if(re(r)<0||isNaN(re(r))){vex.dialog.alert(acfw_edit_coupon.fill_form_propery_error_msg);return}}const l=Lo(t,i,n),{category_id:d,product_id:u}=l;s.push(i=="category"?d:u),t.replaceWith(Ve(l,i,n)),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),M(!0)}function Do(){const e=J(this),t=e.closest("tr"),o=t.closest("table"),n=t.closest("tbody"),i=t.find("td").length,c=o.data("type"),a=t.find("td.object").data(c),s=o.data("exclude");let l;switch(c){case"category":l=s.indexOf(parseInt(a.category_id));break;case"product":default:l=s.indexOf(parseInt(a.product_id));break}l!==-1&&s.splice(l,1),o.data("exclude",s),o.find(".wc-product-search").data("exclude",s),t.remove(),n.find("tr").length<=0&&n.append(W(i,c)),M(!0)}function Lo(e,t,o){let n={};return t=="category"?n={category_id:parseInt(e.find(".wc-product-search").val()+""),quantity:parseInt(e.find(".condition-quantity").val()+""),category_label:e.find(".wc-product-search option:selected").text()}:n={product_id:parseInt(e.find(".wc-product-search").val()+""),quantity:parseInt(e.find(".condition-quantity").val()+""),product_label:e.find(".wc-product-search option:selected").text()},o&&(n.discount_type=e.find("select.discount_type").val(),n.discount_value=e.find("input.discount_value").val()),n}const v=jQuery,C=document.querySelector("#acfw_bogo_deals");acfw_edit_coupon={...acfw_edit_coupon,bogo_toggle_editing_mode:M};function Qo(){v(C).on("click",".acfw-styled-table tfoot .add-table-row",qo),v(C).on("click",".acfw-styled-table td.actions a.edit",Fo),v(C).on("click","tr.add-edit-form .actions .cancel",jo),v(C).on("click","tr.add-edit-form .actions .condition-product-add",So),v(C).on("click",".acfw-styled-table td.actions a.remove",Do),v(C).on("click","button#save-bogo-deals",mo),v(C).on("click","button#clear-bogo-deals",ho),v(C).on("change acfw_load","select#bogo-condition-type,select#bogo-deals-type",fo),v(C).on("change acfw_fetch_data",".combined-objects-form select,.combined-objects-form input",vo),v(C).on("change acfw_fetch_data",".any-products-trigger-form input",yo),v(C).on("change acfw_fetch_data",".any-products-apply-form input,.any-products-apply-form select",wo),v(C).on("change",".condition-quantity",Oo),v(C).on("blur",".wc_input_price",ot),v(C).css("min-height",v("#coupon_options").height()),v(C).on("change","input[name='bogo_type']",Y),v(C).on("change acfw_load","input[name='bogo_type']",go),v(C).on("change","#bogo-repeat-limit",Y),v(C).on("click",".acfw-styled-table .actions .remove",Y),v(C).find(".notice-option").on("change","input,textarea,select",Y),v("form#post").on("submit",bo),v(C).find("select#bogo-condition-type,select#bogo-deals-type").trigger("acfw_load"),v("#woocommerce-coupon-data").on("change acfw_load","select#discount_type",To),v("#woocommerce-coupon-data select#discount_type").trigger("acfw_load"),v(C).find("input[name='bogo_type']:checked").trigger("acfw_load")}function To(){const e=v(this),t=e.closest("#general_coupon_data"),o=t.find("p.form-field input");if(e.val()==="acfw_bogo"){t.addClass("acfw-bogo-type"),v("#acfw_bogo_deals").show();for(let n=0;n<=o.length;n++)["expiry_date","_acfw_coupon_sort_priority","_acfw_show_on_my_coupons_page","_acfw_force_apply_url_coupon","_acfw_coupon_label","coupon_amount"].includes(v(o[n]).prop("name"))||v(o[n]).prop("disabled",!0)}else{t.removeClass("acfw-bogo-type"),v("#acfw_bogo_deals").hide();for(let n=0;n<=o.length;n++)["expiry_date","_acfw_coupon_sort_priority","coupon_amount"].includes(v(o[n]).prop("name"))||v(o[n]).prop("disabled",!1)}}function Y(){M(!0)}function Oo(){const e=jQuery(this);e.val()<1&&e.val(1)}var Pe=jQuery;function Mo(){const e=Pe(".toggle-enable-fields");e.on("change",".toggle-trigger-field",Io),e.find(".toggle-trigger-field").trigger("change")}function Io(){const e=Pe(this),t=e.closest(".toggle-enable-fields"),o=t.find("select,textarea,input:not(.toggle-trigger-field)"),n=!e.prop("checked");o.prop("disabled",n),n?o.closest(".form-field").addClass("disabled"):o.closest(".form-field").removeClass("disabled")}var F=jQuery;function Ao(){const e=document.querySelector("#acfw_url_coupon");F(e).on("click",".copy-coupon-url",Eo),No(),typeof QRCode<"u"&&Ho()}function No(){F("input#_acfw_coupon_url").after('<button type="button" class="copy-coupon-url" data-clipboard-target="#_acfw_coupon_url">\n    <svg width="15" height="15" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 460 460" style="enable-background:new 0 0 460 460;" xml:space="preserve">\n      <g>\n        <path d="M425.934,0H171.662c-18.122,0-32.864,14.743-32.864,32.864v77.134h30V32.864c0-1.579,1.285-2.864,2.864-2.864h254.272\n          c1.579,0,2.864,1.285,2.864,2.864v254.272c0,1.58-1.285,2.865-2.864,2.865h-74.729v30h74.729\n          c18.121,0,32.864-14.743,32.864-32.865V32.864C458.797,14.743,444.055,0,425.934,0z"/>\n        <path d="M288.339,139.998H34.068c-18.122,0-32.865,14.743-32.865,32.865v254.272C1.204,445.257,15.946,460,34.068,460h254.272\n          c18.122,0,32.865-14.743,32.865-32.864V172.863C321.206,154.741,306.461,139.998,288.339,139.998z M288.341,430H34.068\n          c-1.58,0-2.865-1.285-2.865-2.864V172.863c0-1.58,1.285-2.865,2.865-2.865h254.272c1.58,0,2.865,1.285,2.865,2.865v254.273h0.001\n          C291.206,428.715,289.92,430,288.341,430z"/>\n      </g>\n    </svg>\n    </button>'),new ClipboardJS(".copy-coupon-url")}function Eo(){F(this).after('<span class="coupon-url-copied">'.concat(acfw_edit_coupon.copied_label,"</span>")),setTimeout(()=>{F("span.coupon-url-copied").fadeOut(500)},1e3)}function Ho(){F("#acfw_url_coupon").find(".options_group").prepend('<div class="acfw-qr-code-container">\n        <div id="acfw-qr-code"></div>\n        <a id="acfw-download-qr-link" href="#">'.concat(acfw_edit_coupon.download_qr_image_label,"</a>\n    </div>")),Vo()}function Vo(){var e=F("input#_acfw_coupon_url").val(),t=F("#acfw-download-qr-link");if(e){let o=F("#acfw-qr-code");try{new QRCode(o[0],{text:e,width:200,height:200,colorDark:"#000000",colorLight:"#ffffff",correctLevel:QRCode.CorrectLevel.L}).makeCode(e),t.click(function(){var i=F("#acfw-qr-code img"),c=i.attr("src");t.attr("href",c),t.attr("download","".concat(F("#title").val(),".png"))})}catch(n){F("#acfw-qr-code").remove(),F("#acfw-download-qr-link").addClass("disabled"),F("#acfw-download-qr-link").before('<p class="error-message">'.concat(acfw_edit_coupon.error_generate_qr_image,"</p>"))}}else F(".acfw-qr-code-container").hide()}const y=jQuery;function Po(){const e=document.querySelector("#acfw_scheduler"),t=e.querySelector("#_acfw_schedule_start"),o=e.querySelector("#_acfw_schedule_expire"),n=document.querySelector("#general_coupon_data p.expiry_date_field");y(e).on("change",".date-field,.date-hour,.date-minute",Ro),y(e).on("click",".clear-scheduler-fields",Uo),y(n).css("display","none"),y(t).trigger("change acfw_load"),y(o).trigger("change acfw_load"),y(e).on("change acfw_load",".acfw-section-toggle input",Bo),y(e).find(".acfw-section-toggle input").trigger("acfw_load"),y(".wrap").on("submit","form#post",Jo),zo()}function zo(){var i,c;const e=document.querySelector("#_acfw_schedule_start"),t=document.querySelector("#_acfw_schedule_expire"),o=(i=flatpickr.parseDate(t.value,"Y-m-d H:i:S"))!=null?i:null,n=(c=flatpickr.parseDate(e.value,"Y-m-d H:i:S"))!=null?c:null;o&&o.setMinutes(o.getMinutes()-1),n&&n.setMinutes(n.getMinutes()+1),y(e).flatpickr({allowInput:!0,enableTime:!0,altInput:!0,allowInvalidPreload:!0,altFormat:"Y-m-d h:i K",dateFormat:"Y-m-d H:i:S",maxDate:o,onChange:function([a],s,l){a?(a.setMinutes(a.getMinutes()+1),t._flatpickr.set("minDate",a),Ce()):t._flatpickr.set("minDate",null)}}),y(t).flatpickr({allowInput:!0,enableTime:!0,altInput:!0,altFormat:"Y-m-d h:i K",dateFormat:"Y-m-d H:i:S",minDate:n,onChange:function([a],s,l){a?(a.setMinutes(a.getMinutes()-1),e._flatpickr.set("maxDate",a),Ce()):e._flatpickr.set("maxDate",null)}})}function Ce(){const e=flatpickr.parseDate(y("#_acfw_schedule_start").val(),"Y-m-d H:i:S"),t=flatpickr.parseDate(y("#_acfw_schedule_expire").val(),"Y-m-d H:i:S");e>=t?(y("#_acfw_schedule_start").parent().addClass("error"),y("#_acfw_schedule_expire").parent().addClass("error")):(y("#_acfw_schedule_start").parent().removeClass("error"),y("#_acfw_schedule_expire").parent().removeClass("error"))}function Jo(e){y(".acfw-date-range-schedules-section span.date-time-field").hasClass("error")&&(e.preventDefault(),vex.dialog.alert({unsafeMessage:acfw_edit_coupon.invalid_scheduler_time}),y("#publishing-action .spinner").removeClass("is-active"),y("#publishing-action #publish").removeClass("disabled"))}function Ro(){const e=y(this).closest(".date-time-field"),t=e.find(".date-field");t.val()?t.prop("required",!0):t.prop("required",!1)}function Uo(){const e=document.querySelector("#acfw_scheduler"),t=e.querySelector("#_acfw_schedule_start"),o=e.querySelector("#_acfw_schedule_expire"),n=y(this).siblings(".date-time-field");n.find("input").prop("required",!1).val(""),n.find("input")[0]._flatpickr.clear(),y(t).trigger("change"),y(o).trigger("change")}function Bo(){const e=y(this),o=e.closest(".acfw-scheduler-section").find(".options_group");e.is(":checked")?(o.removeClass("disabled"),o.find(".date-field,.days-time-field label input,textarea").prop("disabled",!1),y("#acfw_scheduler .options_group input").trigger("acfw_load")):(o.addClass("disabled"),o.find(".date-field,.days-time-field label input,textarea").prop("disabled",!0)),o.find("input").trigger("change")}const m=jQuery;let se=!1;function Wo(){m("#usage_limit_coupon_data").on("change","#reset_usage_limit_period",Yo),m("#usage_restriction_coupon_data .acfw_exclude_coupons_field,#usage_restriction_coupon_data .acfw_allowed_customers_field,#usage_restriction_coupon_data .acfw_allowed_coupons_field,#usage_restriction_coupon_data .acfw_product_attributes_field,#usage_restriction_coupon_data .acfw_exclude_product_attributes_field").on("click change focus","input,select",Zo),m("#acfw-auto-apply-coupon").on("change","#acfw_auto_apply_coupon_field",Ko),m("#acfw-virtual-coupon").on("change","#acfw_enable_virtual_coupons",Xo),m("#acfw_cart_conditions").on("change",".condition-types",en),m("#woocommerce-coupon-data").on("change acfw_load","#discount_type",tn),m("#woocommerce-coupon-data").on("change acfw_load","#discount_type",nn),m("#woocommerce-coupon-data").on("focusin","#discount_type",on),m("#acfw_bogo_deals").on("change acfw_load","select#bogo-deals-type",cn),m("#acfw_bogo_deals").on("change","input[name='acfw_bogo_auto_add_products']",an),m("#acfw_scheduler").on("change",".acfw-daytime-schedules-section .acfw-section-toggle input[type='checkbox']",sn),m("body").on("change acfw_load","input#individual_use",dn),m("#woocommerce-coupon-data #discount_type").trigger("acfw_load"),Go(),ln(),rn()}function Go(){m("p.acfw_exclude_coupons_field").insertAfter("p.form-field.individual_use_field")}function Yo(){const{usage_limits:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(e,"</div>")}),m(this).val("none")}function Zo(){if(se)return;se=!0;const{usage_restriction:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert exclude-coupon">'.concat(e,"</div>"),afterClose:()=>se=!1}),m(this).val("").blur()}function Ko(){const{auto_apply:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert auto-apply">'.concat(e,"</div>")}),m(this).prop("checked",!1)}function Xo(){const{virtual_coupons:e}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert auto-apply">'.concat(e,"</div>")}),m(this).prop("checked",!1)}function en(){const e=m(this),t=e.closest("#acfw_cart_conditions"),o=e.closest(".add-condition-form"),n=t.data("premium-conditions"),i=t.find(".acfw-dyk-notice-holder");let c=o.find(".acfw-dyk-notice");c.length||(o.append(i.html()),c=o.find(".acfw-dyk-notice")),m.inArray(e.val(),n)>=0?c.show():c.hide()}function tn(){m(this).val()==="acfw_bogo"?m("p.acfw-dyk-notice-general").hide():m("p.acfw-dyk-notice-general").show()}function on(){m(this).data("cachedval",m(this).val())}function nn(){var o;const e=m(this).val(),{cashback_coupon:t}=acfw_edit_coupon.upsell;(e==="acfw_percentage_cashback"||e==="acfw_fixed_cashback")&&(vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(t,"</div>")}),m(this).val((o=m(this).data("cachedval"))!=null?o:"percent"))}function cn(){const e=m(this),o=e.closest("#acfw_bogo_deals").find(".bogo-auto-add-products-field"),n=o.find("input[type='checkbox']");e.val()==="specific-products"?(n.prop("disabled",!1),o.addClass("show")):(n.prop("disabled",!1),o.removeClass("show"))}function an(){m(this).prop("checked",!1);const{bogo_auto_add_get_products:t}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert usage-limits">'.concat(t,"</div>")}),m(this).val("none")}function sn(){const e=m(this),{day_time_schedules:t}=acfw_edit_coupon.upsell;vex.dialog.alert({unsafeMessage:'<div class="upsell-alert day-time-schedules">'.concat(t,"</div>")}),e.prop("checked",!1).trigger("acfw_load")}function ln(){const e=m("p.acfw_allowed_coupons_field");e.insertAfter("p.form-field.individual_use_field"),e.addClass("hidden")}function dn(){const e=m(this),t=m(".acfw_allowed_coupons_field"),o=t.find("select");e.is(":checked")?(o.prop("disabled",!1),t.show()):(o.prop("disabled",!0),t.hide())}function rn(){const e=jQuery("p.acfw_product_attributes_field"),t=jQuery("p.acfw_exclude_product_attributes_field"),o=jQuery('label[for="exclude_product_categories"]').closest("div.options_group"),n=jQuery('<div class="options_group"></div>');n.append(e),n.append(t),n.insertAfter(o)}const un=jQuery;function pn(){_n()}function _n(){const e=un("p._acfw_exclude_wholesale_items_field");e&&e.insertAfter("p.form-field.exclude_sale_items_field")}function fn(e){const{slug:t,action:o,placeholder:n}=e;return'\n    <div class="search-widget search-'.concat(t,'">\n      <input class="search-input" type="text" placeholder="').concat(n,'" data-action="').concat(o,'" />\n      <button type="button" class="clear-search dashicons-before dashicons-no-alt"></button>\n      <div class="search-results"></div>\n    </div>\n  ')}function gn(e,t){const o=e.map(({url:n,title:i})=>'<li><a href="'.concat(mn(n,t),'" rel="noopener noreferrer nofollow" target="_blank">').concat(i,"</a></li>")).join("");return"<ul>".concat(o,"</ul>")}function mn(e,t){return"".concat(e,"?utm_source=acfwf&utm_medium=help_modal&utm_campaign=kb_search&utm_term=").concat(t)}function le(e){const{title:t,className:o}=e;let{links:n}=e;const{is_premium:i}=acfw_edit_coupon.help_modal;return i&&(n=n.filter(c=>(c==null?void 0:c.freeOnly)===void 0||!(c!=null&&c.freeOnly))),'\n    <div class="links-list '.concat(o,'">\n      <h3>').concat(t,"</h3>\n\n      ").concat(e!=null&&e.search?fn(e==null?void 0:e.search):"","\n\n      <ul>\n        ").concat(n.map(c=>"<li>".concat(hn(c),"</li>")).join(""),"\n      </ul>\n    </div>\n  ")}function hn(e){const{title:t,url:o}=e,{is_premium:n}=acfw_edit_coupon.help_modal;return'<a href="'.concat(n&&(e!=null&&e.premiumUrl)?e==null?void 0:e.premiumUrl:o,'">').concat(t,"</a>")}function qe(e){const{labels:t,images_url:o,is_premium:n}=acfw_edit_coupon.help_modal,{target:i,left:{title:c,content:a,videos:s},right:{links:l,kbs:d,tutorials:u}}=e,r={slug:"kb-articles",action:"acfw_search_help_kb_articles",placeholder:t.search_placeholder},w=n?"acfwp":"acfwf",$="https://advancedcouponsplugin.com/pricing/?utm_source=acfwf&utm_medium=help_modal&utm_campaign=help_modal_".concat(i,"_upgrade_link"),k="https://advancedcouponsplugin.com/?utm_source=".concat(w,"&utm_medium=help_modal&utm_campaign=help_brand_link_").concat(i);return'\n    <div class="header">\n      <div class="logo">\n        <a href="'.concat(k,'" target="_blank"><img src="').concat(o,'acfw-logo.png" alt="Advanced Coupons logo" /></a>\n      </div>\n      ').concat(n?"":'\n        <div class="upgrade-link">\n          <a href="'.concat($,'" target="_blank">\n            <span>').concat(t.upgrade_to_premium,'</span>\n            <i class="dashicons dashicons-external"></i>\n          </a>\n        </div>\n      '),'\n    </div>\n    <main>\n      <h1 class="title">').concat(c,'</h1>\n      <div class="content">\n        ').concat(a,"\n      </div>\n      ").concat(s.length?'<div class="video-gallery-placeholder"><img src="'.concat(o,'spinner-2x.gif" alt="Loading videos" /><p>').concat(t.loading_videos,"</p></div>"):"","\n    </main>\n    <aside>\n      ").concat(le({title:t.rel_links,className:"relevant-links",links:l}),"\n      ").concat(le({title:t.kb_articles,className:"knowledge-base-articles",links:d,search:r}),"\n      ").concat(le({title:t.tut_guides,className:"tutorials-guides",links:u}),"\n    </aside>\n  ")}function vn(e){const{errorMsg:t}=e;return'\n    <div class="acfw-help-modal-error">\n      <p>'.concat(t,"</p>\n    </div>\n  ")}function bn(e){const{images_url:t}=acfw_edit_coupon.help_modal,{permission_request:o,allow:n,cancel:i}=acfw_edit_coupon.help_modal.labels;return'\n  <div id="acfw-help-modal-permission-request" data-module="'.concat(e,'">\n    <img src="').concat(t,'acfw-logo.png" />\n    <p>').concat(o,'</p>\n    <p class="actions">\n      <button class="button-primary allow" type="button">').concat(n,'</button>\n      <button class="button cancel" type="button">').concat(i,"</button>\n    </p>\n  </div>\n  ")}function ze(){const{images_url:e,labels:t}=acfw_edit_coupon.help_modal;return'<div id="acfw-help-modal-placeholder">\n    <img src="'.concat(e,'spinner-2x.gif" />\n    <p>').concat(t.loading_content,"</p>\n  </div>")}function yn(e){return'\n  <div class="acfw-help-video-gallery">\n    <div class="videos">\n      '.concat(e[0].embed?e[0].embed:Je(e[0]),"\n    </div>\n    ").concat(e.length>1?'\n      <ul class="thumbnails">\n        '.concat(e.map((t,o)=>"\n            <li ".concat(o===0?'class="active"':"",'>\n              <a href="javascript:void(0);" data-videoid="').concat(t.videoid,'">\n                <img src="').concat(t.thumbnail,'" title="').concat(t.title,'" />\n              </a>\n              <span class="title">').concat(t.title,"</span>\n            </li>\n            ")).join(""),"\n      </ul>\n      "):"","\n    \n  </div>\n  ")}function Je(e){return'\n  <div class="no-video" style="background-image:url('.concat(e.thumbnail,');">\n    <a href="').concat(e.url,'" rel="noreferer noopener" >\n      <span>').concat(acfw_edit_coupon.help_modal.labels.no_video,"</span>\n    </a>\n  </div>\n  ")}const _e=jQuery;let V=[],Re="";function Ue(e,t){const{_secure_nonce:o}=acfw_edit_coupon.help_modal;e.length&&_e.post(ajaxurl,{action:"acfw_get_help_videos_oembed",urls:e.map(n=>n.url),width:_e(".acfw-help-vex .vex-content main").width(),_nonce:o},n=>{n=n.map(i=>{const c=e.findIndex(a=>a.url===i.url);return i.title=c>=0?e[c].title:"",i}),V=n,Re=t,Be(n)},"json")}function wn(e,t){if(!V.length||t!==Re){Ue(e,t);return}Be(V)}function Be(e){const t=_e(".acfw-help-vex .video-gallery-placeholder");t.length&&t.replaceWith(yn(e))}function $n(){const e=jQuery(this),t=e.closest("li"),o=e.closest(".acfw-help-video-gallery"),n=o.find(".videos"),i=o.find("ul.thumbnails li"),c=e.data("videoid");if(t.hasClass("active"))return;i.removeClass("active"),t.addClass("active");const a=V.findIndex(s=>s.videoid===c);a>=0&&n.html(V[a].embed?V[a].embed.replace("oembed","oembed&autoplay=1"):Je(V[a]))}const ne=jQuery,fe=[];function xn(){const{allow_fetch:e}=acfw_edit_coupon.help_modal,o=ne(this).closest(".acfw-help-link").data("module");vex.dialog.open({unsafeMessage:'\n      <a class="vex-close" href="javascript:void(0);"></a>\n      '.concat(e?ze():bn(o),"\n    "),className:"vex-theme-plain acfw-help-vex",showCloseButton:!1,buttons:{}}),e&&We(o)}function de(e){const t=ne("#acfw-help-modal-placeholder");t.length&&(t.replaceWith(e),ne(".acfw-help-vex").find("main a,aside a").attr("target","_blank").attr("rel","noopener noreferrer nofollow"))}function We(e){const{_secure_nonce:t}=acfw_edit_coupon.help_modal;let o=null;if(o=kn(e)){de(qe(o)),wn(o.left.videos,e);return}ne.post(ajaxurl,{action:"acfw_fetch_help_data",module:e,_nonce:t},n=>{fe.push(n),de(qe(n)),Ue(n.left.videos,e)},"json").fail(n=>{de(vn(n.responseJSON))})}function kn(e){const t=fe.findIndex(o=>o.target===e);return t>=0?fe[t]:null}const he=jQuery;let E=null,U=null;function Cn(){const t=he(this).closest(".search-widget"),o=t.find("input.search-input"),n=t.find(".search-results"),{labels:i,images_url:c,_secure_nonce:a}=acfw_edit_coupon.help_modal,s=o.val();if(!s){clearTimeout(E),E=null,n.height(0).html(""),t.removeClass("show-clear");return}t.addClass("show-clear"),qn({action:o.data("action"),term:o.val(),_nonce:a},()=>{n.height(35).html('<div class="loading"><img src="'.concat(c,'spinner.gif" /></div>'))},l=>{t.hasClass("show-clear")&&(l.length?(U={term:s,results:l},n.html(gn(l,s))):n.html('<div class="no-result">'.concat(i.search_no_results,"</div>")),n.height(n.find("ul,.no-result").height()+3))})}function qn(e,t,o){if(E&&(clearTimeout(E),E=null),e.term===(U==null?void 0:U.term)){o(U.results);return}E=setTimeout(()=>{t(),he.post(ajaxurl,e,o,"json")},1e3)}function Fn(){const t=he(this).closest(".search-widget"),o=t.find("input.search-input"),n=t.find(".search-results");clearTimeout(E),E=null,o.val(""),n.height(0).html(""),t.removeClass("show-clear")}const jn=jQuery;function Sn(){const{_secure_nonce:e}=acfw_edit_coupon.help_modal,o=jQuery(this).closest("#acfw-help-modal-permission-request"),n=o.data("module");o.replaceWith(ze()),jn.post(ajaxurl,{action:"acfw_save_fetch_help_permission",_nonce:e},()=>{We(n),acfw_edit_coupon.help_modal.allow_fetch=!0},"json")}function Dn(){vex.closeAll()}const N=jQuery;function Ln(){N("#post-body").on("click",".acfw-help-modal-trigger",xn),N("body").on("click",".acfw-help-vex .vex-close",()=>vex.closeAll()),N("body").on("click",".acfw-help-vex .acfw-help-video-gallery ul.thumbnails li a",$n),N("body").on("keyup",".acfw-help-vex .search-widget input.search-input",Cn),N("body").on("click",".acfw-help-vex .search-widget button.clear-search",Fn),N("body").on("click",".acfw-help-vex #acfw-help-modal-permission-request button.allow",Sn),N("body").on("click",".acfw-help-vex #acfw-help-modal-permission-request button.cancel",Dn)}function Qn(){const e=document.querySelectorAll("#post-body .acfw-help-link"),{help_text:t,images_url:o}=acfw_edit_coupon.help_modal;e.forEach(n=>{const i='\n      <a class="acfw-help-modal-trigger" href="javascript:void(0);">'.concat(t,' \n        <img class="acfw-icon" src="').concat(o,'help-icon.svg" alt="').concat(t,'" />\n      </a>\n    ');N(n).html(i)})}const{labels:h}=acfw_edit_coupon.send_coupon;function Tn(){return'<button type="button" class="button acfw-send-coupon-btn">'.concat(h.title,"</button>")}const On=jQuery,p=new Map;function Ge(e="send_coupon_to",t="email"){p.set("section",e),p.set("option",t),p.set("send_to",t==="user"?"user":""),p.set("user_id","0"),p.set("name",""),p.set("email",""),p.set("create_account",""),p.set("segment_ids","0"),p.set("segments",h.pushengage.segment_placeholder),p.set("title",acfw_edit_coupon.send_coupon.pushengage.default_content.title),p.set("message",acfw_edit_coupon.send_coupon.pushengage.default_content.message),p.set("url",acfw_edit_coupon.send_coupon.pushengage.default_content.url)}function Fe(){const e=On(this),t=e.data("key");let o=e.val()?e.val().toString():"";switch(t){case"option":p.set("option",o);break;case"user":const n=e.find("option:selected");p.set("user_id",o),p.set("name",lodash.first(n.text().split(" ("))),p.set("email",lodash.last(n.text().split("&ndash; ")).replace(")",""));break;case"email":e.removeClass("error"),nt(o)||o===""?(p.set(t,o),p.set("user_id","0")):(p.set(t,""),e.addClass("error"));break;case"create_account":o=e.is(":checked")?o:"",p.set(t,o);break;case"url":e.removeClass("error"),De(o)||o===""?p.set(t,o):(p.set(t,""),e.addClass("error"));break;case"segments":o==="create_new_segment"&&(e.val(null).trigger("change"),window.location.href=acfw_edit_coupon.send_coupon.pushengage_segment_page),o||(o="0-".concat(h.pushengage.segment_placeholder));const i=o.split(","),c=i.map(s=>{const[l]=s.split("-");return l}),a=i.map(s=>s.split("-").slice(1).join("-"));p.set("segment_ids",c),p.set("segments",a);break;default:p.set(t,o)}X("confirm_and_send")}function Mn(){return'\n  <div class="acfw-send-coupon-form-section '.concat(p.get("section")==="send_coupon_to"?"current":"",'" data-section="send_coupon_to">\n    <div class="section-number">\n      <span>1</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(h.send_coupon_to,'</h3>\n      <div class="section-content">\n        ').concat(In(p.get("option")),'\n        <button type="button" class="button-primary acfw-next-section-btn" style="margin-top: 10px" data-next_section="customer_details">').concat(h.next,"</button>\n      </div>\n    </div>\n  </div>\n  ")}function In(e){switch(e){case"email":return'<label>\n          <input type="radio" name="acfw_send_coupon[to]" value="user" data-key="send_to" checked />\n           <span>'.concat(h.email.existing_customer_account,'<span>\n        </label>\n        <label>\n          <input type="radio" name="acfw_send_coupon[to]" value="email" data-key="send_to" />\n           <span>').concat(h.email.new_customer,"<span>\n        </label>");case"pushengage":return'<select id="acfw-send-coupon-to-segments" class="condition-value wc-enhanced-select" multiple data-placeholder="'.concat(h.pushengage.segment_placeholder,'" data-key="segments">\n          ').concat(An(),"\n        </select>")}return""}function An(){const{segments:e}=acfw_edit_coupon.send_coupon.pushengage;let t="";for(const o of e)t+='<option value="'.concat(o.segment_id,"-").concat(o.segment_name,'">').concat(o.segment_name,"</option>");return t+='<option value="create_new_segment">'.concat(h.pushengage.create_new_segment,"</option>"),t}function Nn(){return'\n  <div class="acfw-send-coupon-form-section '.concat(p.get("section")==="customer_details"?"current":"",'" data-section="customer_details">\n    <div class="section-number">\n      <span>2</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(En(p.get("option")),'</h3>\n      <div class="section-content">\n        ').concat(Hn(p.get("option")),'\n        <button type="button" class="button-primary acfw-next-section-btn" data-next_section="confirm_and_send">').concat(h.next,"</button>\n      </div>\n    </div>\n  </div>\n  ")}function En(e){switch(e){case"email":return h.email.customer_details;case"pushengage":return h.pushengage.details}return""}function Hn(e){switch(e){case"email":return'<div class="customer-details-form user-form show">\n          <select data-placeholder="'.concat(h.email.search,'" name="acfw_send_coupon[user]" data-key="user" class="wc-customer-search" style="width:100%"></select>\n        </div>\n        <div class="customer-details-form guest-form">\n          <input type="text" placeholder="').concat(h.email.name,'" name="acfw_send_coupon[name]" data-key="name" />\n          <input type="email" placeholder="').concat(h.email.email,'" name="acfw_send_coupon[email]" data-key="email" />\n          <label>\n            <input type="checkbox" data-key="create_account" value="yes" /> \n            <span>').concat(h.email.create_new_user_account,"</span>\n        </div>");case"pushengage":return'<div class="message-form show">\n          <div>\n            <label>'.concat(h.pushengage.title,'</label>\n            <input type="text" placeholder="').concat(h.pushengage.title_placeholder,'" value="').concat(p.get("title"),'" name="acfw_send_coupon[title]" data-key="title" />\n          </div>\n          <div>\n            <label>').concat(h.pushengage.message,'</label>\n            <input type="text" placeholder="').concat(h.pushengage.message_placeholder,'" value="').concat(p.get("message"),'" name="acfw_send_coupon[message]" data-key="message" />\n          </div>\n          <div>\n            <label>').concat(h.pushengage.url,'</label>\n            <input type="text" placeholder="').concat(h.pushengage.url_placeholder,'" value="').concat(p.get("url"),'" name="acfw_send_coupon[url]" data-key="url" />\n          </div>\n      </div>')}return""}function Vn(){return'\n  <div class="acfw-send-coupon-form-section '.concat(p.get("section")==="confirm_and_send"?"current":"",'" data-section="confirm_and_send">\n    <div class="section-number">\n      <span>3</span>\n    </div>\n    <div class="section-inner">\n      <h3>').concat(h.confirm_and_send,'</h3>\n      <div class="section-content">\n        ').concat(Rn(p.get("option")),"\n      </div>\n    </div>\n  </div>\n  ")}function Pn(){return'\n  <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M8.90625 8.59363V1.40613C8.90625 1.23328 8.7666 1.09363 8.59375 1.09363L1.40625 1.09363C1.2334 1.09363 1.09375 1.23328 1.09375 1.40613V4.92175C1.09375 4.96472 1.12891 4.99988 1.17188 4.99988H1.71875C1.76172 4.99988 1.79688 4.96472 1.79688 4.92175V1.79675L8.20313 1.79675V8.203H5.07813C5.03516 8.203 5 8.23816 5 8.28113V8.828C5 8.87097 5.03516 8.90613 5.07813 8.90613H8.59375C8.7666 8.90613 8.90625 8.76648 8.90625 8.59363ZM4.14648 6.37976L4.65625 6.88953C4.66663 6.89985 4.6797 6.90706 4.69397 6.91033C4.70824 6.91359 4.72314 6.91279 4.73697 6.90801C4.75081 6.90323 4.76303 6.89466 4.77224 6.88328C4.78145 6.8719 4.78728 6.85816 4.78906 6.84363L4.99414 5.09167C5 5.04187 4.95801 4.9989 4.90723 5.00476L3.15527 5.20984C3.09082 5.21765 3.06348 5.29675 3.10938 5.34265L3.62109 5.85437L1.11914 8.35632C1.08887 8.3866 1.08887 8.4364 1.11914 8.46667L1.5332 8.88074C1.56348 8.91101 1.61328 8.91101 1.64356 8.88074L4.14648 6.37976Z" fill="#3A6FAC"/>\n  </svg>\n  '}function zn(){return'\n  <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">\n    <path d="M10.875 1.87512H1.125C0.917578 1.87512 0.75 2.0427 0.75 2.25012V9.75012C0.75 9.95754 0.917578 10.1251 1.125 10.1251H10.875C11.0824 10.1251 11.25 9.95754 11.25 9.75012V2.25012C11.25 2.0427 11.0824 1.87512 10.875 1.87512ZM10.4062 3.17356V9.28137H1.59375V3.17356L1.27031 2.92161L1.73086 2.32981L2.23242 2.72004H9.76875L10.2703 2.32981L10.7309 2.92161L10.4062 3.17356ZM9.76875 2.71887L6 5.64856L2.23125 2.71887L1.72969 2.32864L1.26914 2.92043L1.59258 3.17239L5.5957 6.28489C5.71083 6.37433 5.85246 6.42288 5.99824 6.42288C6.14403 6.42288 6.28566 6.37433 6.40078 6.28489L10.4062 3.17356L10.7297 2.92161L10.2691 2.32981L9.76875 2.71887Z" fill="white"/>\n  </svg>\n  '}function Jn(){return'\n    <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">\n      <path d="M8.90625 8.59363V1.40613C8.90625 1.23328 8.7666 1.09363 8.59375 1.09363L1.40625 1.09363C1.2334 1.09363 1.09375 1.23328 1.09375 1.40613V4.92175C1.09375 4.96472 1.12891 4.99988 1.17188 4.99988H1.71875C1.76172 4.99988 1.79688 4.96472 1.79688 4.92175V1.79675L8.20313 1.79675V8.203H5.07813C5.03516 8.203 5 8.23816 5 8.28113V8.828C5 8.87097 5.03516 8.90613 5.07813 8.90613H8.59375C8.7666 8.90613 8.90625 8.76648 8.90625 8.59363ZM4.14648 6.37976L4.65625 6.88953C4.66663 6.89985 4.6797 6.90706 4.69397 6.91033C4.70824 6.91359 4.72314 6.91279 4.73697 6.90801C4.75081 6.90323 4.76303 6.89466 4.77224 6.88328C4.78145 6.8719 4.78728 6.85816 4.78906 6.84363L4.99414 5.09167C5 5.04187 4.95801 4.9989 4.90723 5.00476L3.15527 5.20984C3.09082 5.21765 3.06348 5.29675 3.10938 5.34265L3.62109 5.85437L1.11914 8.35632C1.08887 8.3866 1.08887 8.4364 1.11914 8.46667L1.5332 8.88074C1.56348 8.91101 1.61328 8.91101 1.64356 8.88074L4.14648 6.37976Z" fill="#3A6FAC"/>\n    </svg>\n  '}function Rn(e){var o,n;switch(e){case"email":var t=!p.get("name")||!p.get("email")?"disabled":"";return"<p>\n          <strong>".concat(h.email.customer,":</strong> ").concat((o=p.get("name"))!=null?o:"","\n          ").concat(p.get("email")?"&lt;".concat(p.get("email"),">"):"",'\n        </p>\n        <p><a class="preview-email-link  ').concat(t,'" href="#">').concat(h.email.preview_email," ").concat(Pn(),'</a></p>\n        <button type="button" class="button-primary acfw-send-email-btn" ').concat(t,">").concat(h.email.send_email," ").concat(zn(),'</button>\n        <p class="request-message"></p>');case"pushengage":var t=!p.get("title")||!p.get("message")||!p.get("url")?"disabled":"";return"<p>\n          <strong>".concat(h.pushengage.segment,":</strong> ").concat((n=p.get("segments"))!=null?n:"",'\n        </p>\n        <p><a class="preview-pushengage-link ').concat(t,'" href="#">').concat(h.pushengage.preview_pushengage," ").concat(Jn(),'</a></p>\n        <button type="button" class="button-primary acfw-send-pushengage-btn" ').concat(t,">\n        ").concat(h.pushengage.send_pushengage,'</button>\n        <p class="request-message"></p>')}return""}const Un=jQuery;function Bn(){return'\n    <div id="acfw-send-coupon">\n      <h2>'.concat(h.title,'</h2>\n\n      <div class="option-sections">\n        <label>').concat(h.select_options.label,'</label>\n        <select id="acfw-send-coupon-options" data-key="option">\n          ').concat(h.select_options.options.map(e=>"<option value='".concat(e.value,"'>").concat(e.label,"</option>")).join(""),'\n        </select>\n      </div>\n\n      <div class="description-sections">\n        <p class="description">').concat(h.description.email,'</p>\n      </div>\n\n      <div class="acfw-send-coupon-form-sections">\n        ').concat(ee("send_coupon_to")(),"\n        ").concat(ee("customer_details")(),"\n        ").concat(ee("confirm_and_send")(),"\n      </div>\n    </div>\n  ")}function X(e){Un(".acfw-send-coupon-modal").find("[data-section='".concat(e,"']")).replaceWith(ee(e)())}function ee(e){switch(e){case"send_coupon_to":return Mn;case"customer_details":return Nn;case"confirm_and_send":return Vn}return()=>{}}const _=jQuery;function Wn(){Gn(),Ge(),_("body").on("click","button.acfw-send-coupon-btn",je),_("body").on("change clearForm",".acfw-send-coupon-form-section input[type='radio']:checked",Yn),_("body").on("click",".acfw-send-coupon-form-section .acfw-next-section-btn",Zn),_("body").on("click",".acfw-send-coupon-form-section .section-number,.acfw-send-coupon-form-section h3",Kn),_("body").on("change",".acfw-send-coupon-form-section input, .acfw-send-coupon-form-section select",Fe),_("body").on("click",".acfw-send-coupon-form-section .preview-email-link",Xn),_("body").on("click",".acfw-send-coupon-form-section .preview-pushengage-link",ei),_("body").on("click",".acfw-send-coupon-form-section .acfw-send-email-btn",ti),_("body").on("click",".acfw-send-coupon-form-section .acfw-send-pushengage-btn",oi),_("body").on("click","#acfw-send-coupon .acfw-button-pushengage-install",ii),_("body").on("change","#acfw-send-coupon #acfw-send-coupon-options",ni),_("body").on("change","#acfw-send-coupon #acfw-send-coupon-options",Fe),window.location.href.includes("sendcoupon")&&je()}function Gn(){_(".page-title-action").after(Tn())}function je(){vex.dialog.open({unsafeMessage:Bn(),className:"vex-theme-plain acfw-send-coupon-modal",showCloseButton:!0,buttons:{},afterOpen:()=>_(document.body).trigger("wc-enhanced-select-init")})}function Yn(){const o=_(this).val().toString()==="user"?".user-form":".guest-form";_(".acfw-send-coupon-form-section .customer-details-form").removeClass("show").find("input,select").prop("disabled",!0),_(".acfw-send-coupon-form-section ".concat(o)).addClass("show").find("input,select").prop("disabled",!1)}function Zn(){const t=_(this).data("next_section");_(".acfw-send-coupon-form-section").removeClass("current"),_(".acfw-send-coupon-form-section[data-section='".concat(t,"']")).addClass("current"),p.set("section",t)}function Kn(){const e=_(this).closest(".acfw-send-coupon-form-section");e.hasClass("current")||(_(".acfw-send-coupon-form-section").removeClass("current"),e.addClass("current")),p.set("section",e.data("section"))}function Xn(){if(_(this).hasClass("disabled"))return;const t=new URLSearchParams;t.append("action","acfw_advanced_coupon_preview_email"),t.append("email_id","acfw_coupon_email"),t.append("args[coupon_id]",_("#post_ID").val()),t.append("args[name]",p.get("name")),t.append("args[email]",p.get("email")),t.append("args[user_id]",p.get("user_id")),t.append("_wpnonce",acfw_edit_coupon.send_coupon.form_email_nonce),window.open("".concat(ajaxurl,"?").concat(t.toString()),"_blank")}function ei(){if(_(this).hasClass("disabled"))return;const t=acfw_edit_coupon.send_coupon.pushengage.storename,o=acfw_edit_coupon.send_coupon.pushengage.coupon_code,n=p.get("url");let i=p.get("title"),c=p.get("message");i=i.replace("{storename}",t),c=c.replace("{coupon_code}",o);const a=new Notification(i,{body:c});a.onclick=function(s){s.preventDefault(),window.open(n,"_blank")}}function ti(){_(this).prop("disabled",!0),_("#acfw-send-coupon .request-message").html("").removeClass("success error"),wp.apiFetch({path:"/coupons/v1/sendcoupon",method:"POST",data:{coupon_id:_("#post_ID").val(),customer:parseInt(p.get("user_id"))?p.get("user_id"):p.get("email"),name:p.get("name"),create_account:p.get("create_account")}}).then(t=>{ve(),ie("success",t.message)}).catch(t=>ie("error",t.message))}function oi(){_(this).prop("disabled",!0),_("#acfw-send-coupon .request-message").html("").removeClass("success error"),wp.apiFetch({path:"/coupons/v1/sendcoupon/pushengage",method:"POST",data:{coupon_id:_("#post_ID").val(),segments:p.get("segments"),segment_ids:p.get("segment_ids"),title:p.get("title"),message:p.get("message"),url:p.get("url")}}).then(t=>{ve("confirm_and_send","pushengage"),ie("success",t.message)}).catch(t=>ie("error",t.message))}function ve(e="confirm_and_send",t="email"){Ge(e,t),_("#acfw-send-coupon").find("select:not(#acfw-send-coupon-options),input[type='text'],input[type='email']").val("").trigger("change"),_("#acfw-send-coupon").find("input[type='radio']").prop("checked",!1),_("#acfw-send-coupon").find("label:first-child input[type='radio']").prop("checked",!0).trigger("clearForm"),_("#acfw-send-coupon").find("input[type='checkbox']").prop("checked",!1),_("#acfw-send-coupon").find("input[name='acfw_send_coupon[title]']").val(acfw_edit_coupon.send_coupon.pushengage.default_content.title).trigger("change"),_("#acfw-send-coupon").find("input[name='acfw_send_coupon[url]']").val(acfw_edit_coupon.send_coupon.pushengage.default_content.url).trigger("change"),_("#acfw-send-coupon").find("input[name='acfw_send_coupon[message]']").val(acfw_edit_coupon.send_coupon.pushengage.default_content.message).trigger("change")}function ie(e,t){_("#acfw-send-coupon .request-message").html(t).addClass(e)}function ni(){let e="send_coupon_to";_(".acfw-send-coupon-form-section").removeClass("current"),_(".acfw-send-coupon-form-section[data-section='".concat(e,"']")).addClass("current");let t=_("#acfw-send-coupon-options").val();ve(e,t),!acfw_edit_coupon.send_coupon.is_pushengage_plugin_active&&t==="pushengage"?(t="pushengage_not_installed",_(".acfw-send-coupon-form-sections").hide()):acfw_edit_coupon.send_coupon.is_pushengage_plugin_active&&t==="pushengage"&&!acfw_edit_coupon.send_coupon.is_pushengage_site_connected?(t="pushengage_site_not_connected",_(".acfw-send-coupon-form-sections").hide()):acfw_edit_coupon.send_coupon.is_pushengage_plugin_active&&t==="pushengage"&&acfw_edit_coupon.send_coupon.is_pushengage_error?(t="pushengage_error",_(".acfw-send-coupon-form-sections").hide()):_(".acfw-send-coupon-form-sections").show(),_("#acfw-send-coupon .description").html(h.description[t]),X("send_coupon_to"),X("customer_details"),X("confirm_and_send"),_(document.body).trigger("wc-enhanced-select-init")}function ii(){const e=_(this),t=_('<span class="installing-text">'.concat(h.installing," ...</span>")),o=_('<span class="error-text" style="color: red; display: none;"></span>'),n=location.href;e.prop("disabled",!0).after(t).after(o),_.ajax({url:ajaxurl,type:"POST",data:{action:"acfw_install_activate_plugin",plugin_slug:"pushengage",silent:!0,nonce:acfw_edit_coupon.send_coupon.pushengage_download_nonce}}).done(i=>{i.success?(window.stop(),setTimeout(()=>{window.location.href=n},400)):o.text(i.data).show()}).fail(i=>{var a;t.remove();const c=((a=i.responseJSON)==null?void 0:a.data)||"An unexpected error occurred.";o.text(c).show(),e.prop("disabled",!1)})}const{modules:Z,upsell:ci}=acfw_edit_coupon;jQuery(document).ready(e=>{Z.indexOf("acfw_cart_conditions_module")>-1&&Xt(),Z.indexOf("acfw_bogo_deals_module")>-1&&Qo(),Z.indexOf("acfw_url_coupons_module")>-1&&Ao(),Z.indexOf("acfw_scheduler_module")>-1&&Po(),ci&&Wo(),Mo(),Qn(),Ln(),ai(),Wn(),pn()});function ai(){const t=new URLSearchParams(window.location.search).get("type");t&&window.location.pathname.includes("post-new.php")&&jQuery("select#discount_type").val(t).trigger("change")}export{si as __vite_legacy_guard};
